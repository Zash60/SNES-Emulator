name: Fix AndroidX Error

on:
  workflow_dispatch: # Rode manualmente

permissions:
  contents: write

jobs:
  fix-properties:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Configure Git
        run: |
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions@github.com"

      # ------------------------------------------------------------------
      # CRIA O ARQUIVO GRADLE.PROPERTIES FALTANTE
      # ------------------------------------------------------------------
      - name: Create gradle.properties
        run: |
          echo "Criando gradle.properties com suporte a AndroidX..."
          
          cat <<EOF > gradle.properties
          # Habilita o suporte às bibliotecas AndroidX (Corrige o erro checkDebugAarMetadata)
          android.useAndroidX=true
          
          # Migra automaticamente bibliotecas antigas para AndroidX
          android.enableJetifier=true
          
          # Configuração de memória para evitar travamentos no build
          org.gradle.jvmargs=-Xmx2048m -Dfile.encoding=UTF-8
          EOF

      # ------------------------------------------------------------------
      # COMMIT E PUSH
      # ------------------------------------------------------------------
      - name: Commit Fix
        run: |
          git add gradle.properties
          
          # Só comita se houver mudança
          if git diff-index --quiet HEAD --; then
             echo "gradle.properties já existe e está correto."
          else
             git commit -m "Fix: Enable AndroidX in gradle.properties"
             git push
          fi
